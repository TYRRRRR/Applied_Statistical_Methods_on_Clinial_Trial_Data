---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
```

### Read in the Data

```{r}
###Read in the clinical trial data and print the head of the data
df <- read.table("C:/Users/tong2/Desktop/DBS.txt",header = TRUE)

###Derive a new col called diff
df$diff <- df$DBP5-df$DBP1

###Print the head of the df
head(df)
```
### Simple Analysis on Diff
```{r}
### assumption of equal var should be tested
var.test(diff ~ TRT, df)
### perform t test
t.test(diff ~ TRT, df, var.equal=T)
### if normality is violated, we use non-parametric method
wilcox.test(diff ~ TRT,df)

```

### Bootstrapping Method to evaluate Diff (metric of interest)
```{r}
# define a function to calculate the mean difference
calcDiff <- function(dat,i){
  return (diff(tapply(df[i,]$diff,df[i,]$TRT,mean)))
}
# number of bt
nboot = 1000
# call function
bootMean = boot(df,calcDiff,R=1000)
plot(bootMean)
```

### One-way ANOVA for Time Changes
```{r}
anovaDF <- df[,2:7] %>%
  group_by(TRT) %>%
  summarise_at(vars(DBP1:DBP5),mean)

anovaDF
# Turn Wide sheet into long form so that Anova can perform
dfLong <- df %>% pivot_longer(cols = starts_with("DBP"),
                              names_to = "time",
                              names_prefix = "DBP",
                              values_to = "DBP") %>%
  arrange(time,Subject)


```


